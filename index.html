<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Happy New Year 2026</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Patrick+Hand&family=Inter:wght@400;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#030014;
  --bg2:#0a0033;
  --paper:#fff7fc;
  --paper2:#ffeff7;
  --pink:#ff2f8f;
  --ink:#3a255e;
  --muted:#6a5a85;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  overflow:hidden;
  font-family:Inter,system-ui;
  background:
    radial-gradient(1200px 700px at 70% 25%, rgba(170,80,255,.25), transparent 60%),
    radial-gradient(900px 650px at 20% 75%, rgba(0,210,255,.14), transparent 60%),
    linear-gradient(180deg,var(--bg1),var(--bg2));
  -webkit-tap-highlight-color: transparent;
}

canvas#fx{position:fixed;inset:0;z-index:0}

/* ====== Modal stage ====== */
.stage{
  position:relative;
  z-index:2;
  height:100vh;
  height:100dvh;
  display:grid;
  place-items:center;
  padding:
    max(16px, env(safe-area-inset-top))
    max(16px, env(safe-area-inset-right))
    max(18px, env(safe-area-inset-bottom))
    max(16px, env(safe-area-inset-left));
}

/* Backdrop when letter is open */
.backdrop{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.42);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  opacity:0;
  pointer-events:none;
  transition: opacity .35s ease;
  z-index:1;
}
.backdrop.show{
  opacity:1;
  pointer-events:auto;
}

/* ====== Letter card ====== */
.letter{
  width:min(720px, calc(100vw - 32px));
  border-radius:28px;
  background: linear-gradient(var(--paper), var(--paper2));
  box-shadow: 0 28px 90px rgba(0,0,0,.55);
  position:relative;

  /* hidden state */
  display:none;
  overflow:hidden;
}

.letter.show{
  display:block;
  animation: popIn .55s cubic-bezier(.16,.95,.18,1) both;
}

@keyframes popIn{
  from{opacity:0; transform:translateY(18px) scale(.98)}
  to{opacity:1; transform:translateY(0) scale(1)}
}

/* Inner scroll area (so mobile doesn't overflow) */
.letter-inner{
  max-height: min(72dvh, 560px);
  overflow:auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  padding: 18px 18px 18px;
}

/* Close button - stays visible */
.close-btn{
  position: sticky;
  top: 10px;
  margin-left:auto;
  display:grid;
  place-items:center;
  width:36px;height:36px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.06);
  background: rgba(255,255,255,.75);
  color: rgba(70,50,100,.9);
  cursor:pointer;
  font-weight:900;
  font-size:18px;
  box-shadow: 0 10px 24px rgba(0,0,0,.10);
}
.close-btn:hover{ transform: scale(1.03); }

/* Header */
.h1{
  font-family:Pacifico;
  font-size: clamp(30px, 5.2vw, 44px);
  color: var(--ink);
  margin: 6px 0 0;
  text-align:center;
}
.year{
  text-align:center;
  margin: 6px 0 10px;
  font-weight: 900;
  font-size: clamp(42px, 7.2vw, 62px);
  color: var(--pink);
  letter-spacing: clamp(2px, 1vw, 7px);
  text-shadow: 0 16px 40px rgba(255,47,143,.18);
}

.divider{
  height:10px;
  width:min(260px, 70%);
  margin: 8px auto 12px;
  background:
    radial-gradient(circle at 10% 50%, rgba(255,47,143,.65) 0 3px, transparent 3px),
    radial-gradient(circle at 35% 50%, rgba(0,210,255,.55) 0 3px, transparent 3px),
    radial-gradient(circle at 60% 50%, rgba(255,211,107,.55) 0 3px, transparent 3px),
    radial-gradient(circle at 85% 50%, rgba(181,155,255,.55) 0 3px, transparent 3px);
}

p{
  font-family:"Patrick Hand";
  font-size: clamp(18px, 4.4vw, 23px);
  line-height: 1.62;
  color: rgba(70,50,110,.86);
  margin: 12px 0;
  text-align:center;
}

.name{
  display:inline-block;
  padding: 1px 10px;
  border-radius:999px;
  background: rgba(255,47,143,.12);
  border: 1px solid rgba(255,47,143,.18);
  color: var(--pink);
  font-weight: 900;
}

.sign{
  margin-top:16px;
  padding-top:12px;
  border-top:1px dashed rgba(0,0,0,.18);
  display:flex;
  justify-content:space-between;
  font-size: 13px;
  color: var(--muted);
}

/* ====== Bottom button fixed everywhere ====== */
.bottom-bar{
  position:fixed;
  left:0; right:0;
  bottom:0;
  z-index:3;
  display:flex;
  justify-content:center;
  pointer-events:none;
  padding:
    12px
    max(14px, env(safe-area-inset-right))
    calc(14px + env(safe-area-inset-bottom))
    max(14px, env(safe-area-inset-left));
}

.btn{
  pointer-events:auto;
  border:0;
  cursor:pointer;
  font-weight:900;
  letter-spacing:.3px;
  padding: 14px 22px;
  border-radius:999px;
  color:#fff;
  background: linear-gradient(160deg,#ff2f8f,#ff8ac7);
  box-shadow: 0 18px 55px rgba(0,0,0,.40);
  transform: translateY(0);
  transition: transform .15s ease;
}
.btn:hover{ transform: translateY(-1px); }
.btn.hide{ display:none; }

/* Small phones tweaks */
@media (max-width:420px){
  .letter{ border-radius:24px; }
  .letter-inner{ padding: 16px 14px 14px; }
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce){
  .letter.show{ animation:none; }
  .backdrop{ transition:none; }
}
</style>
</head>

<body>
<canvas id="fx"></canvas>
<div class="backdrop" id="backdrop" aria-hidden="true"></div>

<div class="stage">
  <div class="letter" id="letter" aria-hidden="true">
    <div class="letter-inner">
      <button class="close-btn" id="closeBtn" aria-label="ƒê√≥ng">‚úï</button>

      <div class="h1">Happy New Year</div>
      <div class="year">2026</div>
      <div class="divider"></div>

      <p>
        <span class="name" id="toLine">B·∫°n ∆°i</span>,<br>
        NƒÉm m·ªõi g√µ c·ª≠a, <span id="p0">m√¨nh</span> hy v·ªçng <span id="p1">b·∫°n</span> lu√¥n b√¨nh y√™n trong t√¢m h·ªìn
        v√† m·∫°nh kh·ªèe ƒë·ªÉ theo ƒëu·ªïi m·ªçi h√†nh tr√¨nh <span id="p2b">b·∫°n</span> l·ª±a ch·ªçn.<br>
        M·ªói s√°ng th·ª©c d·∫≠y, mong <span id="p2">b·∫°n</span> kh√°m ph√° ƒë∆∞·ª£c m·ªôt ni·ªÅm vui nh·ªè
        khi·∫øn n·ª• c∆∞·ªùi t·ª± nhi√™n n·ªü tr√™n m√¥i,
        v√† c√≥ th√™m m·ªôt l√Ω do ƒë·ªÉ tin t∆∞·ªüng b∆∞·ªõc ti·∫øp.
      </p>

      <p>
        Ch√∫c <span id="p3">b·∫°n</span> nƒÉm 2026 th·∫≠t nhi·ªÅu ni·ªÅm vui,
        s·ªëng tho·∫£i m√°i v·ªõi nh·ªØng ƒëi·ªÅu m√¨nh ch·ªçn,
        kh√¥ng v·ªôi v√†ng c≈©ng ch·∫≥ng c·∫ßn t·ª± t·∫°o √°p l·ª±c cho b·∫£n th√¢n.<br>
        Mong r·∫±ng h·∫°nh ph√∫c s·∫Ω ƒë·∫øn m·ªôt c√°ch nh·∫π nh√†ng v·ªõi <span id="p3b">b·∫°n</span>,
        ƒë·ªÉ m·ªói quy·∫øt ƒë·ªãnh ƒë·ªÅu v·ªØng t√¢m h∆°n,
        v√† ƒë·ªÉ <span id="p3c">b·∫°n</span> t·∫≠n h∆∞·ªüng t·ª´ng kho·∫£nh kh·∫Øc ƒë·ªùi th∆∞·ªùng
        m·ªôt c√°ch b√¨nh y√™n v√† tr·ªçn v·∫πn. ‚ú®
      </p>

      <div class="sign">
        <span>Th√¢n m·∫øn,</span>
        <span>- 2026 üéÜ</span>
      </div>
    </div>
  </div>
</div>

<!-- Fixed bottom button on both phone & laptop -->
<div class="bottom-bar">
  <button class="btn" id="openBtn">Xem l·ªùi ch√∫c ‚ú®</button>
</div>

<script>
/* ===== NAME + HONORIFIC ===== */
const params = new URLSearchParams(location.search);
let name = (params.get("name") || "").trim();
let honor = (params.get("honorific") || "ban").toLowerCase();

try { name = decodeURIComponent(name); } catch {}
name = name.replace(/\s+/g," ").trim();
if (name.length > 26) name = name.slice(0,26) + "‚Ä¶";

// ban => m√¨nh/b·∫°n ; chi => em/ch·ªã
const you   = honor === "chi" ? "ch·ªã" : "b·∫°n";
const me    = honor === "chi" ? "em"  : "m√¨nh";
const title = honor === "chi" ? "Ch·ªã" : "B·∫°n";

document.getElementById("toLine").textContent = name ? `${title} ${name} ∆°i` : `${title} ∆°i`;
document.getElementById("p0").textContent = me;
["p1","p2","p2b","p3","p3b","p3c"].forEach(id=>{
  const el = document.getElementById(id);
  if(el) el.textContent = you;
});

/* ===== FIREWORKS (mobile optimized) ===== */
const canvas = document.getElementById("fx");
const ctx = canvas.getContext("2d", { alpha:true });

const isMobile = matchMedia("(max-width: 600px)").matches || /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
let w,h,dpr;

function resize(){
  dpr = Math.max(1, Math.min(isMobile ? 1.5 : 2, window.devicePixelRatio || 1));
  w = Math.floor(innerWidth);
  h = Math.floor(innerHeight);
  canvas.width = Math.floor(w * dpr);
  canvas.height = Math.floor(h * dpr);
  canvas.style.width = w + "px";
  canvas.style.height = h + "px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize", resize, {passive:true});
resize();

const TAU=Math.PI*2;
const rand=(a,b)=>a+Math.random()*(b-a);
const hsl=(hh,s,l,a=1)=>`hsla(${hh},${s}%,${l}%,${a})`;

const rockets=[], sparks=[];
const gravity=0.045, air=0.985;
const MAX = isMobile ? 2600 : 6000;
const AUTO_RATE = isMobile ? 0.018 : 0.03;

const palettes=[{b:330,s:22},{b:45,s:14},{b:200,s:18},{b:285,s:16}];
const pickHue=()=>{const p=palettes[(Math.random()*palettes.length)|0];return (p.b + rand(-p.s,p.s) + 360) % 360};

class Rocket{
  constructor(x,y,tx,ty,hue){
    this.x=x; this.y=y; this.h=hue;
    this.vx=(tx-x)*rand(.018,.024);
    this.vy=(ty-y)*rand(.018,.024)-rand(2.1,3.4);
    this.tr=[];
  }
  step(){
    this.x+=this.vx; this.y+=this.vy;
    this.vy+=gravity*.25;
    this.vx*=air; this.vy*=air;
    this.tr.push({x:this.x,y:this.y});
    if(this.tr.length>(isMobile?12:18)) this.tr.shift();
    if(Math.abs(this.vx)+Math.abs(this.vy)<.9){
      explode(this.x,this.y,this.h);
      return false;
    }
    return true;
  }
  draw(){
    for(let i=0;i<this.tr.length-1;i++){
      const t=i/this.tr.length;
      ctx.strokeStyle=hsl(this.h,100,65,.08+t*.35);
      ctx.lineWidth=2;
      ctx.beginPath();
      ctx.moveTo(this.tr[i].x,this.tr[i].y);
      ctx.lineTo(this.tr[i+1].x,this.tr[i+1].y);
      ctx.stroke();
    }
    ctx.fillStyle=hsl(this.h,100,70,.9);
    ctx.beginPath(); ctx.arc(this.x,this.y,2.4,0,TAU); ctx.fill();
  }
}

class Spark{
  constructor(x,y,a,s,h){
    this.x=x; this.y=y;
    this.vx=Math.cos(a)*s;
    this.vy=Math.sin(a)*s;
    this.h=h;
    this.life=rand(isMobile?45:60, isMobile?90:110);
    this.max=this.life;
    this.sz=rand(1.0, isMobile?2.0:2.6);
    this.tw=Math.random()<0.5;
  }
  step(){
    this.x+=this.vx; this.y+=this.vy;
    this.vy+=gravity;
    this.vx*=air; this.vy*=air;
    return --this.life>0;
  }
  draw(){
    const t=this.life/this.max;
    const tw = this.tw ? rand(.75,1) : 1;
    const a=t*tw;
    const r=this.sz*(.6+(1-t)*.8);

    ctx.fillStyle=hsl(this.h,100,65,a);
    ctx.beginPath(); ctx.arc(this.x,this.y,r,0,TAU); ctx.fill();

    ctx.fillStyle=hsl(this.h,100,70,a*0.10);
    ctx.beginPath(); ctx.arc(this.x,this.y,r*3.8,0,TAU); ctx.fill();
  }
}

function explode(x,y,hue){
  const ringN = isMobile ? 44 : 70;
  const burstN = isMobile ? 95 : 160;

  for(let i=0;i<ringN && sparks.length<MAX;i++){
    sparks.push(new Spark(x,y,i/ringN*TAU,rand(4,6),hue));
  }
  for(let i=0;i<burstN && sparks.length<MAX;i++){
    sparks.push(new Spark(x,y,rand(0,TAU),rand(2,8),hue+rand(-8,8)));
  }
}

function launch(x,y){
  rockets.push(new Rocket(
    rand(w*.15,w*.85), h+30,
    x ?? rand(w*.2,w*.8),
    y ?? rand(h*.3,h*.7),
    pickHue()
  ));
}

function frame(){
  ctx.fillStyle="rgba(0,0,0,.14)";
  ctx.fillRect(0,0,w,h);

  ctx.save();
  ctx.globalCompositeOperation="lighter";

  for(let i=rockets.length-1;i>=0;i--)
    rockets[i].step()?rockets[i].draw():rockets.splice(i,1);

  for(let i=sparks.length-1;i>=0;i--)
    sparks[i].step()?sparks[i].draw():sparks.splice(i,1);

  ctx.restore();

  if(Math.random()<AUTO_RATE) launch();
  requestAnimationFrame(frame);
}
frame();

/* ===== UI ===== */
const openBtn = document.getElementById("openBtn");
const closeBtn = document.getElementById("closeBtn");
const letter = document.getElementById("letter");
const backdrop = document.getElementById("backdrop");

function openLetter(){
  letter.classList.add("show");
  letter.setAttribute("aria-hidden","false");
  backdrop.classList.add("show");
  backdrop.setAttribute("aria-hidden","false");
  openBtn.classList.add("hide");

  // fireworks volley at center of letter
  const r = letter.getBoundingClientRect();
  const volley = isMobile ? 7 : 10;
  for(let i=0;i<volley;i++){
    setTimeout(()=>launch(
      r.left+r.width/2 + rand(-140,140),
      r.top+r.height/2 + rand(-90,90)
    ), i*(isMobile?140:120));
  }
}

function closeLetter(){
  letter.classList.remove("show");
  letter.setAttribute("aria-hidden","true");
  backdrop.classList.remove("show");
  backdrop.setAttribute("aria-hidden","true");
  openBtn.classList.remove("hide");
}

openBtn.addEventListener("click", openLetter, {passive:true});
closeBtn.addEventListener("click", closeLetter, {passive:true});
backdrop.addEventListener("click", closeLetter, {passive:true});
</script>
</body>
</html>
